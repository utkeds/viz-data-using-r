---
subtitle: "Data Wrangling"
title: "Week 3 - STEM 691"
author: "Dr. Kelly Boles & Dr. Zhen Xu"
format:
  revealjs:
    theme: [simple, utk_eds_style.scss]
    mainfont: Montserrat
    slide-number: true
    transition: fade
    background-transition: fade
    highlight-style: tango
    title-slide-attributes:
      data-background-color: "#4B4B4B"
      data-background-image: slides_images/UnitShortcut.png
      data-background-size: 50%
      data-background-position: 50% 9%
    footer: UTK Educational Data Science
knitr:
  opts_chunk: 
    fig.align: center
    echo: true
    warning: false
    message: false
---

```{r setup, include=FALSE}
library(tidyverse)
library(palmerpenguins)
library(gt)
```

# Weekly Check In, Download `.zip`, Download Slides

# Start Recording

## Today's Agenda {.smaller}
<hr>

- Weekly Check In / .zip Download
- Additional Foundational Skills
    - Other File Types
    - Documentation / Help
    - Troubleshooting Errors
- Reviewing {dplyr} Basics
- More {dplyr}
    - Collaborative Work
- {forcats}
- Looking Ahead


## Norms
<hr>

:::{.compact-font}
| In person norms | And also, for online learning... |
|----------|----------|
| Be fully present to each other & the work. | Keep your video on when possible. In large groups, mute your microphone when not talking. Close/mute/minimize other apps and devices to avoid distraction. |
| Assume positive intent & also take responsibility for the impact you have. | Remember online interaction masks even more of the full story. Notice when you are making assumptions, and seek information to check them. |
| Embrace collaboration. | Use the gallery view so you can see everyone. Use breakout groups as an opportunity to collaborate. |
| Be open to learning and accept non-closure. | Expect the inevitable technical glitches and learning curves. Exercise patience with one another. |
| Be aware of when to step up and step back. When stepping back, do so as an active listener. | Try out different modes of participation. Step back by making space for others to engage in these. |
| Land your plane--get to the point you intended. | We all know how hard it is to be talked at, especially in a Zoom session, so let's keep it to a minimum. |

:::

# Additional Foundational Skills

## How do I know the code ran? {.smaller}
<hr>
- There are a several ways to check
  - call the object
  - `print()` the object
  - `str()` the object
  - `glimpse()` the object
  - `describe()` the object {psych}
  - `View()` the object
- Also look at the variables pane in the secondary sidebar
  - `>` Will expand the object
- No error in the console!
  - i.e., you get a `>` in the console instead of error message

## Reading Documentation
<hr>
 - `?function_name` or `help(function_name)` will pull documentation
 - Can also access on web (Google is your friend!)

## Other File Types
<hr>
:::{.compact-font}
- Ability to read in a data file is critical\
<br>
- Often, data is stored in a `.csv` file
    - `read_csv()` function in `readr` package (part of [tidyverse core](https://www.tidyverse.org/packages/#core-tidyverse))
<br>  
- Sometimes we have an Excel file
    - `read_excel()` function in `readxl` package
<br>   
- Sometimes we have an SPSS file
    - `read_spss()` in `haven` package
<br>    
- Other times we have a Stata file
    - `read_dta()` in `haven` package
<br>    
- Other file types are possible, but these are the most common
- If you have another - google how to read it in!

:::

## Troubleshooting Errors {.smaller}
<hr>
- **Demo**
    - Follow along with `Troubleshooting_Errors_Demo.qmd`:
      - Reading in an Excel file
      - Three types of errors <!-- (forget to load package, file in wrong place, don't store/assign it and call it later) -->
      - Accessing via file pane > Import Dataset
      
# Reviewing {dplyr} Basics

## {dplyr} Review +
<hr>
- Using two datasets
  - full starwars
  - starwars_a (first five rows of starwars)

```{r creating_starwars_a}
starwars_a <- starwars |>
  slice(1:5) |>
  select(1:5)
```

## {dplyr} Review +
<hr>
`select()`
<br>
<hr>
::: {.columns .small-font}

::: {.column width="45%"}

[**Example data - starwars_a**]{.smaller-font}

```{r echo=FALSE}
starwars_a |>
  gt() |>
  tab_options(
    table.width = pct(100),
    table.font.size = px(13),
    data_row.padding = px(2)
  ) |>
  tab_style(
    style = cell_fill(color = "#f9f9f9"),
    locations = cells_body(rows = c(1, 3, 5))
  ) |>
  opt_table_lines(extent = "none")
```

:::

::: {.column style="border-left: 4px solid #FF8200; padding-left: 1em;"}

:::{.fragment}
`data |> select(var1, var2)`

[- Use this to **select columns/variables**]{.smaller-font}
:::

:::{.fragment}
```{r echo=TRUE, eval=TRUE}
starwars_a |>
  select(name, height)
```

:::

:::
:::

## {dplyr} Review +
<hr>
`select()`
<br>
<hr>
::: {.columns .small-font}

::: {.column width="45%"}

[**Example data - starwars_a**]{.smaller-font}

```{r echo=FALSE}
starwars_a |>
  gt() |>
  tab_options(
    table.width = pct(100),
    table.font.size = px(13),
    data_row.padding = px(2)
  ) |>
  tab_style(
    style = cell_fill(color = "#f9f9f9"),
    locations = cells_body(rows = c(1, 3, 5))
  ) |>
  opt_table_lines(extent = "none")
```

:::

::: {.column style="border-left: 4px solid #FF8200; padding-left: 1em;"}

:::{.fragment}
`data |> select(-var1)`

[- Can also **drop columns/variables**]{.smaller-font}
:::

:::{.fragment}
```{r echo=TRUE, eval=TRUE}
starwars_a |>
  select(-hair_color)
```

:::

:::
:::

## {dplyr} Review +
<hr>
`slice()`
<br>
<hr>
::: {.columns .small-font}

::: {.column width="45%"}

[**Example data - starwars_a**]{.smaller-font}

```{r echo=FALSE}
starwars_a |>
  gt() |>
  tab_options(
    table.width = pct(100),
    table.font.size = px(13),
    data_row.padding = px(2)
  ) |>
  tab_style(
    style = cell_fill(color = "#f9f9f9"),
    locations = cells_body(rows = c(1, 3, 5))
  ) |>
  opt_table_lines(extent = "none")
```

:::

::: {.column style="border-left: 4px solid #FF8200; padding-left: 1em;"}

:::{.fragment}
`data |> slice(3:5)`


[- Use this to **select rows/observations**]{.smaller-font}
<br>
:::

:::{.fragment .smaller-font}
```{r echo=TRUE, eval=TRUE}
starwars_a |>
  slice(3:5)
```

:::

:::
:::


## {dplyr} Review +
<hr>
`slice()`
<br>
<hr>
::: {.columns .small-font}

::: {.column width="45%"}

[**Example data - starwars_a**]{.smaller-font}

```{r echo=FALSE}
starwars_a |>
  gt() |>
  tab_options(
    table.width = pct(100),
    table.font.size = px(13),
    data_row.padding = px(2)
  ) |>
  tab_style(
    style = cell_fill(color = "#f9f9f9"),
    locations = cells_body(rows = c(1, 3, 5))
  ) |>
  opt_table_lines(extent = "none")
```

:::

::: {.column style="border-left: 4px solid #FF8200; padding-left: 1em;"}

:::{.fragment}
`data |> slice(-1,-2)`

[- Can also **drop rows/observations**]{.smaller-font}
<br>
:::

:::{.fragment .smaller-font}
```{r echo=TRUE, eval=TRUE}
starwars_a |>
  slice(-1,-2)
```

:::

:::
:::

## {dplyr} Review +
<hr>
`filter()`
<br>
<hr>
::: {.columns .small-font}

::: {.column width="45%"}

[**Example data - starwars_a**]{.smaller-font}

```{r echo=FALSE}
starwars_a |>
  gt() |>
  tab_options(
    table.width = pct(100),
    table.font.size = px(13),
    data_row.padding = px(2)
  ) |>
  tab_style(
    style = cell_fill(color = "#f9f9f9"),
    locations = cells_body(rows = c(1, 3, 5))
  ) |>
  opt_table_lines(extent = "none")
```

:::

::: {.column style="border-left: 4px solid #FF8200; padding-left: 1em;"}

:::{.fragment .smaller-font}
<br>
`data |> filter(var == "brown")`

[- Use this to **filter rows**]{.smaller-font}
:::

:::{.fragment .smaller-font}
```{r}
starwars_a |>
  filter(hair_color == "brown")
```

:::

:::
:::

## {dplyr} Review +
<hr>
`filter()` and `!is.na()`
<br>
<hr>
::: {.columns .small-font}

::: {.column width="45%"}

[**Example data - starwars_a**]{.smaller-font}

```{r echo=FALSE}
starwars_a |>
  gt() |>
  tab_options(
    table.width = pct(100),
    table.font.size = px(13),
    data_row.padding = px(2)
  ) |>
  tab_style(
    style = cell_fill(color = "#f9f9f9"),
    locations = cells_body(rows = c(1, 3, 5))
  ) |>
  opt_table_lines(extent = "none")
```

:::

::: {.column style="border-left: 4px solid #FF8200; padding-left: 1em;"}

:::{.fragment}
`data |> filter(!is.na(var))`

:::{.smaller-font}
- Use this to **filter rows**
- `!is.na()` filters out all `NA` rows/observations for a given column/variable
:::
:::

:::{.fragment .smaller-font}
```{r}
starwars_a |>
  filter(!is.na(hair_color))
```

:::

:::
:::

## {dplyr} Review +
<hr>
`filter()` and `|`
<br>
<hr>
::: {.columns .small-font}

::: {.column width="45%"}

[**Example data - starwars_a**]{.smaller-font}

```{r echo=FALSE}
starwars_a |>
  gt() |>
  tab_options(
    table.width = pct(100),
    table.font.size = px(13),
    data_row.padding = px(2)
  ) |>
  tab_style(
    style = cell_fill(color = "#f9f9f9"),
    locations = cells_body(rows = c(1, 3, 5))
  ) |>
  opt_table_lines(extent = "none")
```

:::

::: {.column style="border-left: 4px solid #FF8200; padding-left: 1em;"}

:::{.fragment}
`filter()`

:::{.smaller-font}
- Use this to **filter rows**
- `|` allows for multiple arguments as condition
:::
:::

:::{.fragment .smaller-font}
```{r}
starwars_a |>
  filter(height > 200 | height < 100)
```

:::

:::{.fragment .smaller-font}
- [*How would I change this if I wanted middle heights?*]{.fragment}
  - [`filter(height <= 200 & height >= 100`)]{.fragment}
:::

:::
:::

## {dplyr} Review +
<hr>
`filter()` and `%in%`
<br>
<hr>
::: {.columns .small-font}

::: {.column width="45%"}

[**Example data - starwars_a**]{.smaller-font}

```{r echo=FALSE}
starwars_a |>
  gt() |>
  tab_options(
    table.width = pct(100),
    table.font.size = px(13),
    data_row.padding = px(2)
  ) |>
  tab_style(
    style = cell_fill(color = "#f9f9f9"),
    locations = cells_body(rows = c(1, 3, 5))
  ) |>
  opt_table_lines(extent = "none")
```

:::

::: {.column style="border-left: 4px solid #FF8200; padding-left: 1em;"}

:::{.fragment}
`filter(var1 %in% vector)`

:::{.smaller-font}
- Use this to **filter rows**
- `%in%` allows for multiple arguments as condition (provided as vector)
- `c()` combines into a vector
:::
:::

:::{.fragment .smaller-font}
```{r}
starwars_a |>
  filter(hair_color %in% c("brown", "blond"))
```

:::

:::
:::

## {dplyr} Review +
<hr>
`rename()`
<br>
<hr>
::: {.columns .small-font}

::: {.column width="45%"}

[**Example data - starwars_a**]{.smaller-font}

```{r echo=FALSE}
starwars_a |>
  gt() |>
  tab_options(
    table.width = pct(100),
    table.font.size = px(13),
    data_row.padding = px(2)
  ) |>
  tab_style(
    style = cell_fill(color = "#f9f9f9"),
    locations = cells_body(rows = c(1, 3, 5))
  ) |>
  opt_table_lines(extent = "none")
```

:::

::: {.column style="border-left: 4px solid #FF8200; padding-left: 1em;"}

:::{.fragment .smaller-font}
`rename(new_var_name = old_var_name)`

- Use this to **rename** a column
:::

:::{.fragment .smaller-font}
```{r}
starwars_a |>
  rename(weight = mass)
```

::::
::::
:::

## {dplyr} Review +
<hr>
`mutate()`
<br>
<hr>
::: {.columns .small-font}

::: {.column width="45%"}

[**Example data - starwars_a**]{.smaller-font}

```{r echo=FALSE}
starwars_a |>
  gt() |>
  tab_options(
    table.width = pct(100),
    table.font.size = px(13),
    data_row.padding = px(2)
  ) |>
  tab_style(
    style = cell_fill(color = "#f9f9f9"),
    locations = cells_body(rows = c(1, 3, 5))
  ) |>
  opt_table_lines(extent = "none")
```

:::

::: {.column style="border-left: 4px solid #FF8200; padding-left: 1em;"}

:::{.fragment .smaller-font}
`data |> mutate(var_name = formula)`

- **Create new variables** from existing ones
- Or **modify** existing variables
:::

::::{.fragment .smaller-font}
```{r eval=F}
starwars_a |>
  mutate(one = height^2,
         two = height*mass,
         hair_color = ifelse(is.na(hair_color),
                             "unknown", hair_color))
```

:::

:::
:::

## {dplyr} Review +
<hr>
`mutate()` & `case_when()`
<br>
<hr>
::: {.columns .small-font}

::: {.column width="45%"}

[**Example data - starwars_a**]{.smaller-font}

```{r echo=FALSE}
starwars_a |>
  gt() |>
  tab_options(
    table.width = pct(100),
    table.font.size = px(13),
    data_row.padding = px(2)
  ) |>
  tab_style(
    style = cell_fill(color = "#f9f9f9"),
    locations = cells_body(rows = c(1, 3, 5))
  ) |>
  opt_table_lines(extent = "none")
```

:::

::: {.column style="border-left: 4px solid #FF8200; padding-left: 1em;"}

:::{.fragment .smaller-font}
`mutate(var_name = case_when(condition ~ formula))`

- **Create new variables** from existing ones based on conditions
:::

:::{.fragment .smaller-font}
```{r}
starwars_a |>
  mutate(height_category = case_when(
    height < 150 ~ "short",
    height >= 150 & height < 180 ~ "average",
    height >= 180 ~ "tall"
  ))
```
:::

:::
:::

## {dplyr} Review +
<hr>
`mutate()` & `case_when()`
<br>
<hr>
::: {.columns .small-font}

::: {.column width="45%"}

[**Example data - starwars_a**]{.smaller-font}

```{r echo=FALSE}
starwars_a |>
  gt() |>
  tab_options(
    table.width = pct(100),
    table.font.size = px(13),
    data_row.padding = px(2)
  ) |>
  tab_style(
    style = cell_fill(color = "#f9f9f9"),
    locations = cells_body(rows = c(1, 3, 5))
  ) |>
  opt_table_lines(extent = "none")
```

:::

::: {.column style="border-left: 4px solid #FF8200; padding-left: 1em;"}

:::{.fragment .smaller-font}
`mutate(var_name = case_when(condition ~ formula))`

- **Create new variables** from existing ones based on conditions
:::

:::{.fragment .smaller-font}
```{r}
starwars_a <- starwars_a |>
  mutate(has_hair = case_when(
    hair_color == "brown" ~ TRUE,
    hair_color == "blond" ~ TRUE,
    TRUE ~ FALSE
  ))
```
:::

:::
:::

## {dplyr} Review +
<hr>
`mutate()` & `case_when()`
<br>
<hr>
::: {.columns .small-font}

::: {.column width="45%"}

[**Example data - starwars_a**]{.smaller-font}

```{r echo=FALSE}
starwars_a |>
  gt() |>
  tab_options(
    table.width = pct(100),
    table.font.size = px(13),
    data_row.padding = px(2)
  ) |>
  tab_style(
    style = cell_fill(color = "#f9f9f9"),
    locations = cells_body(rows = c(1, 3, 5))
  ) |>
  opt_table_lines(extent = "none")
```

:::

::: {.column style="border-left: 4px solid #FF8200; padding-left: 1em;"}

:::{.fragment .smaller-font}
`mutate(var_name = case_when(condition ~ formula))`

- **Create new variables** from existing ones based on conditions
:::

:::{.fragment .smaller-font}
```{r}
starwars_b <- starwars_a |>
  mutate(has_hair = case_when(
    hair_color %in% c("brown", "blond") ~ TRUE,
    is.na(hair_color) ~ NA,
    TRUE ~ FALSE,
  ))
```
:::

:::
:::

# More {dplyr} Functions

## More {dplyr}
<hr>
`distinct()`
<br>
<hr>

::: {.columns .small-font}

::: {.column width="45%"}


[**Example data - starwars**]{.smaller-font}

starwars_a
```{r echo=FALSE}
starwars_a |>
  gt() |>
  tab_options(
    table.width = pct(100),
    table.font.size = px(13),
    data_row.padding = px(2)
  ) |>
  tab_style(
    style = cell_fill(color = "#f9f9f9"),
    locations = cells_body(rows = c(1, 3, 5))
  ) |>
  opt_table_lines(extent = "none")
```

starwars_b
```{r echo=FALSE}
starwars_b |>
  gt() |>
  tab_options(
    table.width = pct(100),
    table.font.size = px(13),
    data_row.padding = px(2)
  ) |>
  tab_style(
    style = cell_fill(color = "#f9f9f9"),
    locations = cells_body(rows = c(1, 3, 5))
  ) |>
  opt_table_lines(extent = "none")
```

:::

::: {.column style="border-left: 4px solid #FF8200; padding-left: 1em;"}

:::{.fragment}
`distinct(var1)`

[- Shows all unique values of a variable]{.smaller-font}
:::

:::{.fragment .smaller-font}
```{r}
starwars_a |>
  distinct(has_hair)
```

```{r}
starwars_b |>
  distinct(has_hair)
```
:::

:::
:::

## More {dplyr}
<hr>
`count()`
<br>
<hr>

::: {.columns .small-font}

::: {.column width="45%"}

[**Example data - starwars**]{.smaller-font}

```{r echo=FALSE}
starwars |>
  slice(1:10)|>
  select(1:3,10,11)|>
  gt() |>
  tab_options(
    table.width = pct(100),
    table.font.size = px(13),
    data_row.padding = px(2)
  ) |>
  tab_style(
    style = cell_fill(color = "#f9f9f9"),
    locations = cells_body(rows = c(1, 3, 5))
  ) |>
  opt_table_lines(extent = "none")
```
[- Note: There are 87 rows in the full `starwars` dataset]{.smaller-font}
:::

::: {.column style="border-left: 4px solid #FF8200; padding-left: 1em;"}

:::{.fragment}
`count(var1)`

[- **Count** unique values of a variable]{.smaller-font}
:::

:::{.fragment .smaller-font}
```{r}
starwars |>
  count(species)
```

:::

:::
:::

## More {dplyr}
<hr>
`count()`
<br>
<hr>
::: {.columns .small-font}

::: {.column width="45%"}

[**Example data - starwars**]{.smaller-font}

```{r echo=FALSE}
starwars |>
  slice(1:10)|>
  select(1:3,10,11)|>
  gt() |>
  tab_options(
    table.width = pct(100),
    table.font.size = px(13),
    data_row.padding = px(2)
  ) |>
  tab_style(
    style = cell_fill(color = "#f9f9f9"),
    locations = cells_body(rows = c(1, 3, 5))
  ) |>
  opt_table_lines(extent = "none")
```
[- Note: There are 87 rows in the full `starwars` dataset]{.smaller-font}
:::

::: {.column style="border-left: 4px solid #FF8200; padding-left: 1em;"}

:::{.fragment}
`count(var1,var2)`

:::{.smaller-font}
- **Count** unique values of a variable
- Or for a set of variables
:::
:::

:::{.fragment .smaller-font}
```{r}
starwars |>
  count(homeworld,species)
```

:::

:::
:::

## More {dplyr}
<hr>
`group_by()`
<br>
<hr>

::: {.columns .small-font}

::: {.column width="45%"}

[**Example data - starwars**]{.smaller-font}

```{r echo=FALSE}
starwars |>
  slice(1:10)|>
  select(1:3,10,11)|>
  gt() |>
  tab_options(
    table.width = pct(100),
    table.font.size = px(13),
    data_row.padding = px(2)
  ) |>
  tab_style(
    style = cell_fill(color = "#f9f9f9"),
    locations = cells_body(rows = c(1, 3, 5))
  ) |>
  opt_table_lines(extent = "none")
```
[- Note: There are 87 rows in the full `starwars` dataset]{.smaller-font}
:::

::: {.column style="border-left: 4px solid #FF8200; padding-left: 1em;"}

:::{.fragment}
`group_by(var1)`

:::{.smaller-font}
- **Group** by a variable and then count
- Here: same as `count()` but in two steps
:::
:::

:::{.fragment .smaller-font}
```{r}
starwars |>
  group_by(species)|>
  summarize(n = n())
```

:::

:::
:::


# Q: If it's an extra step, why use `group_by()`?

# A: You may want to do more than count!

## More {dplyr}
<hr>
`group_by()` & `summarize()`
<br>
<hr>

::: {.columns .small-font}

::: {.column width="45%"}

[**Example data - starwars**]{.smaller-font}

```{r echo=FALSE}
starwars |>
  slice(1:10)|>
  select(1:3,10,11)|>
  gt() |>
  tab_options(
    table.width = pct(100),
    table.font.size = px(13),
    data_row.padding = px(2)
  ) |>
  tab_style(
    style = cell_fill(color = "#f9f9f9"),
    locations = cells_body(rows = c(1, 3, 5))
  ) |>
  opt_table_lines(extent = "none")
```
[- Note: There are 87 rows in the full `starwars` dataset]{.smaller-font}
:::

::: {.column style="border-left: 4px solid #FF8200; padding-left: 1em;"}

:::{.fragment}
`group_by()` & `summarize()`

:::{.smaller-font}
- **Group** by a variable
- With `summarize()` it can do much more!
:::
:::

:::{.fragment .smaller-font}
```{r}
starwars |>
  group_by(species)|>
  summarize(n = n(),
            proportion = n/nrow(starwars)*100)
```
:::

:::
:::

## More {dplyr}
<hr>
`group_by()` & `summarize()`
<br>
<hr>

::: {.columns .small-font}

::: {.column width="45%"}

[**Example data - starwars**]{.smaller-font}

```{r echo=FALSE}
starwars |>
  slice(1:10)|>
  select(1:3,10,11)|>
  gt() |>
  tab_options(
    table.width = pct(100),
    table.font.size = px(13),
    data_row.padding = px(2)
  ) |>
  tab_style(
    style = cell_fill(color = "#f9f9f9"),
    locations = cells_body(rows = c(1, 3, 5))
  ) |>
  opt_table_lines(extent = "none")
```
[- Note: There are 87 rows in the full `starwars` dataset]{.smaller-font}
:::

::: {.column style="border-left: 4px solid #FF8200; padding-left: 1em;"}

:::{.fragment .smaller-font}
`group_by()` & `summarize()`

:::{.extra-small-font}
- **group_by()**: groups data by variable(s)
- **summarize()**: supports summary statistics for the group [(see summary functions on [`dplyr` cheatsheet](https://rstudio.github.io/cheatsheets/data-transformation.pdf)!)]{.blue-font .fragment}
:::
:::

:::{.fragment .smaller-font}
```{r}
starwars |>
  group_by(species)|>
  summarize(mean_height = mean(height, na.rm = TRUE),
            sd_height = sd(height, na.rm = TRUE),
            mean_mass = mean(mass, na.rm = TRUE),
            sd_mass = sd(mass, na.rm = TRUE))
```

:::

:::
:::

## More {dplyr}
<hr>
`group_by()` & `summarize()`
<br>
<hr>

::: {.columns .small-font}

::: {.column width="45%"}

[**Example data - starwars**]{.smaller-font}

```{r echo=FALSE}
starwars |>
  slice(1:10)|>
  select(1:3,10,11)|>
  gt() |>
  tab_options(
    table.width = pct(100),
    table.font.size = px(13),
    data_row.padding = px(2)
  ) |>
  tab_style(
    style = cell_fill(color = "#f9f9f9"),
    locations = cells_body(rows = c(1, 3, 5))
  ) |>
  opt_table_lines(extent = "none")
```
[- Note: There are 87 rows in the full `starwars` dataset]{.smaller-font}
:::

::: {.column style="border-left: 4px solid #FF8200; padding-left: 1em;"}

:::{.fragment .smaller-font}
`group_by()` & `summarize()`

:::{.extra-small-font}
- **group_by()**: groups data by variable(s)
- **summarize()** supports summary statistics for the group
:::
:::

:::{.fragment .smaller-font}
```{r}
starwars |>
  group_by(species)|>
  summarize(med_height = median(height, na.rm = TRUE),
            IQR_height = IQR(height, na.rm = TRUE),
            med_mass = median(mass, na.rm = TRUE),
            IQR_mass = IQR(mass, na.rm = TRUE))
```
:::

:::
:::

## More {dplyr}
<hr>
`group_by()` & `ungroup()`
<br>
<hr>

::: {.columns .small-font}

::: {.column width="45%"}

[**Example data - starwars**]{.smaller-font}

```{r echo=FALSE}
starwars |>
  slice(1:10)|>
  select(1:3,10,11)|>
  gt() |>
  tab_options(
    table.width = pct(100),
    table.font.size = px(13),
    data_row.padding = px(2)
  ) |>
  tab_style(
    style = cell_fill(color = "#f9f9f9"),
    locations = cells_body(rows = c(1, 3, 5))
  ) |>
  opt_table_lines(extent = "none")
```
[- Note: There are 87 rows in the full `starwars` dataset]{.smaller-font}
:::

::: {.column style="border-left: 4px solid #FF8200; padding-left: 1em;"}

:::{.fragment .smaller-font}
`group_by()` & `ungroup()`

:::{.extra-small-font}
- When you use `group_by()`, you should also use `ungroup()` when you are finished
- Otherwise, it'll cause you issues later
:::
:::

:::{.fragment .smaller-font}
```{r}
starwars |>
  group_by(species)|>
  summarize(med_height = median(height, na.rm = TRUE),
            IQR_height = IQR(height, na.rm = TRUE),
            med_mass = median(mass, na.rm = TRUE),
            IQR_mass = IQR(mass, na.rm = TRUE))|>
  ungroup()
```
:::

:::
:::

## More {dplyr}
<hr>
`arrange()`
<br>
<hr>

::: {.columns .small-font}

::: {.column width="45%"}

[**Example data - starwars**]{.smaller-font}

```{r echo=FALSE}
starwars |>
  slice(1:10)|>
  select(1:3,10,11)|>
  gt() |>
  tab_options(
    table.width = pct(100),
    table.font.size = px(13),
    data_row.padding = px(2)
  ) |>
  tab_style(
    style = cell_fill(color = "#f9f9f9"),
    locations = cells_body(rows = c(1, 3, 5))
  ) |>
  opt_table_lines(extent = "none")
```
[- Note: There are 87 rows in the full `starwars` dataset]{.smaller-font}
:::

::: {.column style="border-left: 4px solid #FF8200; padding-left: 1em;"}

:::{.fragment .smaller-font}
`arrange()`

:::{.extra-small-font}
- **Orders**: the rows in ascending order by variable(s)
:::
:::

:::{.fragment .smaller-font}
```{r}
starwars |>
  group_by(species)|>
  summarize(med_height = median(height, na.rm = TRUE),
            IQR_height = IQR(height, na.rm = TRUE),
            med_mass = median(mass, na.rm = TRUE),
            IQR_mass = IQR(mass, na.rm = TRUE))|>
  ungroup()|>
  arrange(med_height)
```
:::

:::
:::

## More {dplyr}
<hr>
`arrange()`
<br>
<hr>

::: {.columns .small-font}

::: {.column width="45%"}

[**Example data - starwars**]{.smaller-font}

```{r echo=FALSE}
starwars |>
  slice(1:10)|>
  select(1:3,10,11)|>
  gt() |>
  tab_options(
    table.width = pct(100),
    table.font.size = px(13),
    data_row.padding = px(2)
  ) |>
  tab_style(
    style = cell_fill(color = "#f9f9f9"),
    locations = cells_body(rows = c(1, 3, 5))
  ) |>
  opt_table_lines(extent = "none")
```
[- Note: There are 87 rows in the full `starwars` dataset]{.smaller-font}
:::

::: {.column style="border-left: 4px solid #FF8200; padding-left: 1em;"}

:::{.fragment .smaller-font}
`arrange()`

:::{.extra-small-font}
- **Orders**: the rows in ascending order by variable(s)
- Adding `desc()` will order in descending order
:::
:::

:::{.fragment .smaller-font}
```{r}
starwars |>
  group_by(species)|>
  summarize(med_height = median(height, na.rm = TRUE),
            IQR_height = IQR(height, na.rm = TRUE),
            med_mass = median(mass, na.rm = TRUE),
            IQR_mass = IQR(mass, na.rm = TRUE))|>
  ungroup()|>
  arrange(desc(med_height))
```
:::

:::
:::

# {dplyr} Titanic Practice!

## {dplyr} Titanic Practice (1 of 2)
<hr>
:::{.smaller-font}
- Open your `dplyr_titanic_practice.qmd` file.
- We'll go to breakout rooms.
- We will come around and answer questions. This one is more in-depth.
- Resources:
    - Week 2 slides
    - Week 3 slides
    - Beck reading
- Think carefully about object assignment. When should you overwrite an object? When should you create a new one?
- We'll come back to whole group for:
    - {forcats}
    - Looking Ahead
:::

## {dplyr} Titanic Practice (2 of 2) {.smaller}
<hr>
Breakout room structure:

- **Individual Think Time**: ~ 5 min (camera off / mute)
  - Review document
  - Review prompts
  - Start planning possible approaches/pseudocode
- **Introductions**: ~ 3 min (camera on/ unmute)
- **Collaborative Work** (camera on/unmute)

# {forcats} [(See cheatsheet)](https://posit.co/wp-content/uploads/2022/10/factors-1.pdf)

## {forcats} (factor vars)
<hr>
`fct_relevel()`
<br>
<hr>

::: {.columns .small-font}

::: {.column width="45%"}

[**Example data - Titanic**]{.smaller-font}

```{r echo=FALSE}
titanic <- read_csv("Titanic-Dataset.csv")

surv_rates_age_class <- titanic |>
  mutate(age_group = case_when(
    Age < 13 ~ "child",
    Age >= 13 & Age < 19 ~ "teen",
    Age >=18 ~ "adult")) |>
  group_by(Pclass, age_group)|>
  summarize(
    avg_survival = mean(Survived, na.rm = TRUE),
    n = n()) |>
  ungroup()|>
  filter(!is.na(age_group))|>
  arrange(desc(avg_survival))

surv_rates_age_class$Pclass <- plyr::mapvalues(surv_rates_age_class$Pclass,
                                         from = c(1,2,3),
                                         to = c("First", "Second", "Third"))

surv_rates_age_class <- surv_rates_age_class |>
  mutate(Pclass = fct_relevel(Pclass, "Second", "Third", "First"))

surv_rates_age_class |>
  gt() |>
  tab_options(
    table.width = pct(100),
    table.font.size = px(13),
    data_row.padding = px(2)
  ) |>
tab_style(
    style = cell_fill(color = "#f9f9f9"),
    locations = cells_body(rows = c(1, 3, 5, 7, 9))
  ) |>
  opt_table_lines(extent = "none")
```
:::

::: {.column style="border-left: 4px solid #FF8200; padding-left: 1em;"}

:::{.fragment .smaller-font}
- X axis lacks order

:::

:::{.fragment .smaller-font}
```{r}
surv_rates_age_class |>
  filter(age_group == "child")|>
  ggplot(aes(x=Pclass, y=avg_survival)) +
  geom_col(fill="#489FDF") +
  labs(title = "Survival Rates by Class for Children",
       x = "Class",
       y = "Survival Rate")
```
:::

:::
:::

## {forcats} (factor vars)
<hr>
`fct_relevel()`
<br>
<hr>

::: {.smaller-font}

- `fct_relevel()` **re-orders factors by hand**
- You manually specify the order

```{r, eval=FALSE}
surv_rates_age_class |>
  filter(age_group == "child")|>
  mutate(Pclass = fct_relevel(Pclass, "First", "Second", "Third"))|>
  ggplot(aes(x=Pclass, y=avg_survival)) +
  geom_col(fill="#489FDF") +
  labs(title = "Survival Rates by Class for Children",
       x = "Class",
       y = "Survival Rate")
```

:::

```{r, echo=FALSE}
surv_rates_age_class|>
  filter(age_group == "child")|>
  mutate(Pclass = fct_relevel(Pclass, "First", "Second", "Third"))|>
  ggplot(aes(x=Pclass, y=avg_survival)) +
  geom_col(fill="#489FDF") +
  labs(title = "Survival Rates by Class for Children",
       x = "Class",
       y = "Survival Rate")
```

## {forcats} (factor vars)
<hr>
`fct_reorder()`
<br>
<hr>

::: {.columns .small-font}

::: {.column width="45%"}

[**Example data - Titanic**]{.smaller-font}

```{r echo=FALSE}
surv_rates_age_class|>
  gt() |>
  tab_options(
    table.width = pct(100),
    table.font.size = px(13),
    data_row.padding = px(2)
  ) |>
tab_style(
    style = cell_fill(color = "#f9f9f9"),
    locations = cells_body(rows = c(1, 3, 5, 7, 9))
  ) |>
  opt_table_lines(extent = "none")
```

:::

::: {.column style="border-left: 4px solid #FF8200; padding-left: 1em;"}

:::{.fragment .smaller-font}
- What if I wanted this reordered by rate, not class?

:::

:::{.fragment .smaller-font}
```{r}
surv_rates_age_class|>
  filter(age_group == "child")|>
  ggplot(aes(x=Pclass, y=avg_survival)) +
  geom_col(fill="#489FDF") +
  labs(title = "Survival Rates by Class for Children",
       x = "Class",
       y = "Survival Rate")
```
:::

:::
:::

## {forcats} (factor vars)
<hr>
`fct_reorder()`
<br>
<hr>

::: {.smaller-font}

- `fct_reorder()` **re-orders factors by values of another variable**

```{r, eval=FALSE}
surv_rates_age_class|>
  filter(age_group == "child")|>
  mutate(Pclass = fct_reorder(Pclass, avg_survival))|>
  ggplot(aes(x=Pclass, y=avg_survival)) +
  geom_col(fill="#489FDF") +
  labs(title = "Survival Rates by Class for Children",
       x = "Class",
       y = "Survival Rate")
```
:::

```{r, echo=FALSE}
surv_rates_age_class|>
  filter(age_group == "child")|>
  mutate(Pclass = fct_reorder(Pclass, desc(avg_survival)))|>
  ggplot(aes(x=Pclass, y=avg_survival)) +
  geom_col(fill="#489FDF") +
  labs(title = "Survival Rates by Class for Children",
       x = "Class",
       y = "Survival Rate")
```

# Looking Ahead

## Looking Ahead
<hr>
- Week 3 Assignment:
    - Gapminder Data
- Reading:
    - Read Healy (2012), Chapter 3
    - Intro to {ggplot2}
    - Skim {ggplot2} cheatsheet
